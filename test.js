
//corecction : 
// EDF IMMO > EDF Immo
// E.D.F INTERNANTIONAL > EDF International
// Framatome > FRAMATOME
const raw = {
  total_count: 56,
  results: [
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'FRAMATOME'
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'DALKIA'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'ELECTRICITE DE STRASBOURG'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'CYCLIFE'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'Energy2Market (E2M)'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'IZIVIA'
    },
    {
      societe_parente: 'FRAMATOME',
      perimetre_juridique_raison_sociale: 'EDVANCE'
    },
    {
      societe_parente: 'EDF Immo',
      perimetre_juridique_raison_sociale: 'LA GERANCE GENERALE FONCIERE'
    },
    {
      societe_parente: 'SOCIETE C3',
      perimetre_juridique_raison_sociale: 'EDF Investissements Groupe'
    },
    {
      societe_parente: 'EDF Holding SAS',
      perimetre_juridique_raison_sociale: 'Groupe EDF Trading'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'Shandong Zhonghua Power Company Ltd.'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'Datang Sanmexia Power Company Ltd.'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'EDF (China) Holding Ltd.'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'TDE SpA'
    },
    {
      societe_parente: 'EDF (China) Holding Ltd.',
      perimetre_juridique_raison_sociale: 'Jiangxi Datang International Fuzhou Power Generation Company Ltd.'
    },
    {
      societe_parente: 'EDF Gas Deutschland',
      perimetre_juridique_raison_sociale: 'FS GmbH'
    },
    {
      societe_parente: 'Lake Acquisitions Ltd.',
      perimetre_juridique_raison_sociale: 'EDF Energy Nuclear Generation Ltd.'
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'EDF HOLDING SAS'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'IZI SOLUTIONS'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'IZI Confort'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'Meco'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'Sloe Centrale Holding BV'
    },
    {
      societe_parente: 'EDF Inc.',
      perimetre_juridique_raison_sociale: 'EDF Trading North America'
    },
    {
      societe_parente: 'EDF Norte Fluminense',
      perimetre_juridique_raison_sociale: 'Companhia Electrica de Sinop (CES)'
    },
    {
      societe_parente: 'Taishan Nuclear Power Joint Venture',
      perimetre_juridique_raison_sociale: 'EDF (China) Holding Ltd.'
    },
    {
      societe_parente: 'EDF Energy UK',
      perimetre_juridique_raison_sociale: 'EDF Energy Holding Ltd.'
    },
    {
      societe_parente: 'TDE SpA',
      perimetre_juridique_raison_sociale: 'Groupe EDISON'
    },
    {
      societe_parente: 'EDF Energy Holding Ltd.',
      perimetre_juridique_raison_sociale: 'NNB Holding Company (HPC) Ltd.'
    },
    {
      societe_parente: null,
      perimetre_juridique_raison_sociale: 'ELECTRICITE DE FRANCE'
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'ENEDIS'
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'EDF Immo'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'Agregio'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'SOWEE'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'EDF ENR'
    },
    {
      societe_parente: 'EDF Immo',
      perimetre_juridique_raison_sociale: 'SOCIETE FONCIERE IMMOBILIERE ET DE LOCATION (SOFILO)'
    },
    {
      societe_parente: 'EDF Pulse Holding',
      perimetre_juridique_raison_sociale: 'Hynamics'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'EDF Norte Fluminense'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'EDF Energy UK'
    },
    {
      societe_parente: 'EDF Belgium',
      perimetre_juridique_raison_sociale: 'Luminus'
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: "COENTREPRISE DE TRANSPORT D'ELECTRICITE"
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA'
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'EDF International'
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'EDF Pulse Holding'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'EDF Inc.'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'EDF Gas Deutschland'
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'EDVANCE'
    },
    {
      societe_parente: 'ELECTRICITE DE FRANCE',
      perimetre_juridique_raison_sociale: 'SOCIETE C3'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'EDF Renouvelables'
    },
    {
      societe_parente: 'EDF DEVELOPPEMENT ENVIRONNEMENT SA',
      perimetre_juridique_raison_sociale: 'DOMOFINANCE'
    },
    {
      societe_parente: 'SOCIETE C3',
      perimetre_juridique_raison_sociale: 'RESOCEANE'
    },
    {
      societe_parente: 'SOCIETE C3',
      perimetre_juridique_raison_sociale: 'Wagram Insurance Company'
    },
    {
      societe_parente: 'Groupe EDF Trading',
      perimetre_juridique_raison_sociale: 'EDF Inc.'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'EDF Belgium'
    },
    {
      societe_parente: 'EDF International',
      perimetre_juridique_raison_sociale: 'Taishan Nuclear Power Joint Venture'
    },
    {
      societe_parente: 'EDF Energy Holding Ltd.',
      perimetre_juridique_raison_sociale: 'Lake Acquisitions Ltd.'
    },
    {
      societe_parente: 'EDF Energy Holding Ltd.',
      perimetre_juridique_raison_sociale: 'NNB Holding Company (SZC) Ltd.'
    }
  ]
};

//get only the list of subsidiaries
const subsidiaries = raw.results;

//tree to be progressively built
const noChildren = [];

let isParent = false;
let theParent = {};
let n = 0;

while (n < 1) {
//while (Object.keys(results).length > 1 & n < Object.keys(raw.results).length) {
  n++;
  //build the tree from the botom adding each time subsidiaries without children
  //take one subsidiary after another
  for (let i = 0; i < Object.keys(subsidiaries).length; i++) {
    isParent = false;
    //browse the list to check if it is a parent of another subsidiary in the list
    for (let j = 0; j < Object.keys(subsidiaries).length; j++) {
      if (subsidiaries[i].perimetre_juridique_raison_sociale == subsidiaries[j].societe_parente ){
        isParent = true;
        //break loop
      };
    };
    if (isParent == false) {
      //if the subsidiary has no children in the list it is added as a children parameter to his parent and removed form the list
      theParent = subsidiaries.find(o => o.perimetre_juridique_raison_sociale == subsidiaries[i].societe_parente);
      if (subsidiaries[i].children != null) {
        console.log(subsidiaries[i]);
        theParent.children = {
          'name' : subsidiaries[i].perimetre_juridique_raison_sociale,
          'children' : subsidiaries[i].children
        }
      } else {
          theParent.children = {
            'name' : subsidiaries[i].perimetre_juridique_raison_sociale,
            'children' : null
        }
      };
      subsidiaries.splice(i, 1);
    };
  };
};

console.log(subsidiaries);

//console.log(noChildren);
//console.log("results : " + Object.keys(results).length);
//console.log("tree : " + Object.keys(noChildren).length);
